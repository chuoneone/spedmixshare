<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest_share.json">
    <meta name="theme-color" content="#0B4C5F">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="images/sped2.png">
    <title>ç‰¹æ•™æ•™æè³‡æºå…±äº«å¹³å° | ç±³å…‹å¸«</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5BBHYN77N9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-5BBHYN77N9');
    </script>
    <link rel="icon" href="sped.ico">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <style>
      :root {
        /* --- é…è‰²å®šç¾© --- */
        --primary-orange: #E67432;   /* æ´»åŠ›æ©˜ (æŒ‰éˆ•/å¼·èª¿) */
        --primary-teal: #0B4C5F;     /* æ·±æµ·æ´‹ç¶  (æ–‡å­—/æ·±è‰²èƒŒæ™¯) */
        --sky-blue: #AEDEF4;         /* æ¸…æ–°è— (è£é£¾/èƒŒæ™¯æ¼¸å±¤) */
        --warm-grey: #E1DFDD;        /* æš–æ²™ç° (èƒŒæ™¯åŸºåº•) */
        
        --text-main: var(--primary-teal);
        --text-light: #546E7A;

        /* --- ç»ç’ƒæ“¬æ…‹è®Šæ•¸ (Glassmorphism) --- */
        /* æ·ºè‰²ç»ç’ƒ (ç”¨æ–¼å¡ç‰‡ã€æ§åˆ¶é¢æ¿) */
        --glass-bg-light: rgba(255, 255, 255, 0.65);
        --glass-border-light: 1px solid rgba(255, 255, 255, 0.5);
        --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        --backdrop-blur: blur(12px);

        /* æ·±è‰²ç»ç’ƒ (ç”¨æ–¼é é¦–ã€é å°¾) */
        --glass-bg-dark: rgba(11, 76, 95, 0.85); /* æ·±æµ·æ´‹ç¶ åŠé€æ˜ */
        --glass-border-dark: 1px solid rgba(255, 255, 255, 0.15);
      }

      body { 
        font-family: 'Noto Sans TC', sans-serif; 
        /* èƒŒæ™¯æ”¹ç‚ºæŸ”å’Œæ¼¸å±¤ï¼Œå¢åŠ æ·±åº¦æ„Ÿï¼Œè®“ç»ç’ƒæ•ˆæœæ›´æ˜é¡¯ */
        background: linear-gradient(135deg, var(--warm-grey) 0%, var(--sky-blue) 100%);
        color: var(--text-main); 
        margin: 0; padding: 0; 
        display: flex; flex-direction: column; 
        min-height: 100vh; 
        background-attachment: fixed; /* è®“èƒŒæ™¯å›ºå®šï¼Œæ»¾å‹•æ™‚æœ‰è¦–å·®æ„Ÿ */
      }
      
      /* --- Header: æ·±è‰²ç»ç’ƒæ•ˆæœ --- */
      header { 
        background: var(--glass-bg-dark);
        backdrop-filter: var(--backdrop-blur);
        -webkit-backdrop-filter: var(--backdrop-blur);
        border-bottom: var(--glass-border-dark);
        color: white; 
        padding: 40px 20px; 
        text-align: center; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        position: relative;
        overflow: hidden;
      }
      /* å¢åŠ ä¸€å€‹ header å…§éƒ¨çš„å…‰æšˆè£é£¾ */
      header::before {
          content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
          background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 60%);
          pointer-events: none;
      }

      header h1 { margin: 0; font-size: 2em; font-weight: 700; letter-spacing: 1px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
      header p { margin-top: 10px; opacity: 0.95; margin-bottom: 20px; font-weight: 500; }

      /* Header å…§çš„é€šçŸ¥æ¡†ï¼šæ›´é€äº®çš„ç»ç’ƒ */
      .notice-box {
        background: rgba(255, 255, 255, 0.15); /* æ¯” header æ›´äº®ä¸€é» */
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px; /* æ›´åœ“æ½¤ */
        padding: 20px 25px;
        max-width: 700px;
        margin: 25px auto;
        text-align: left;
        box-shadow: inset 0 0 15px rgba(255,255,255,0.05); /* å…§ç™¼å…‰æ„Ÿ */
      }
      .notice-title { font-weight: 700; font-size: 1.1em; margin-bottom: 8px; display: block; color: var(--sky-blue); text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
      .notice-content { font-size: 0.95em; line-height: 1.7; margin: 0; color: #f0f4f8; }

      /* --- æŒ‰éˆ•ï¼šç«‹é«”æœå‡æ„Ÿ --- */
      .btn-share, .btn {
        display: inline-block;
        /* ä½¿ç”¨æ¼¸å±¤è£½é€ ç«‹é«”æ„Ÿ */
        background: linear-gradient(145deg, var(--primary-orange), #d16528);
        color: white;
        padding: 12px 30px;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 700;
        /* é›™é‡é™°å½±ï¼šä¸€å±¤æ·±è‰²è£½é€ è·é›¢ï¼Œä¸€å±¤æ©˜è‰²è£½é€ ç™¼å…‰æ„Ÿ */
        box-shadow: 0 6px 15px rgba(230, 116, 50, 0.4), inset 0 2px 3px rgba(255,255,255,0.2);
        transition: all 0.3s ease;
        border: none;
        text-align: center;
      }
      .btn-share { margin-top: 15px; font-size: 1.1em; }
      .btn-share:hover, .btn:hover { 
        transform: translateY(-3px) scale(1.02); 
        box-shadow: 0 8px 25px rgba(230, 116, 50, 0.6), inset 0 2px 3px rgba(255,255,255,0.4);
        background: linear-gradient(145deg, #f38446, var(--primary-orange));
      }
      .btn.disabled { background: #cfd8dc; color: #90a4ae; cursor: not-allowed; pointer-events: none; box-shadow: none; }

      .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; flex: 1; box-sizing: border-box; width: 100%; }
      
      /* --- æ§åˆ¶é¢æ¿ï¼šæ·ºè‰²ç»ç’ƒ --- */
      .control-panel { 
        background: var(--glass-bg-light);
        backdrop-filter: var(--backdrop-blur);
        -webkit-backdrop-filter: var(--backdrop-blur);
        border: var(--glass-border-light);
        box-shadow: var(--glass-shadow);
        border-radius: 20px; /* æ›´åœ“æ½¤ */
        padding: 30px; 
        margin-bottom: 40px; 
        display: flex; flex-wrap: wrap; gap: 20px; 
        align-items: flex-end; justify-content: center;
        /* å¢åŠ ä¸€é»ç™½è‰²æ¼¸å±¤æ¨¡æ“¬åå…‰ */
        background-image: linear-gradient(to bottom right, rgba(255,255,255,0.2), rgba(255,255,255,0));
      }
      
      .filter-group label { font-size: 0.95em; font-weight: 700; color: var(--primary-teal); margin-bottom: 8px; display: block; }
      
      /* è¼¸å…¥æ¡†èˆ‡é¸å–®ï¼šåŠé€æ˜åŒ– */
      #searchInput, select {
        padding: 12px 15px; border-radius: 10px; 
        border: 2px solid rgba(255,255,255,0.5); /* åŠé€æ˜é‚Šæ¡† */
        font-size: 15px; background-color: rgba(255,255,255,0.7); /* åŠé€æ˜èƒŒæ™¯ */
        color: var(--primary-teal); font-weight: 500;
        transition: all 0.3s; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
      }
      #searchInput { width: 220px; }
      #searchInput:focus, select:focus { border-color: var(--primary-orange); outline: none; background-color: rgba(255,255,255,0.9); box-shadow: 0 0 0 3px rgba(230, 116, 50, 0.2); }
      select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%27292.4%27%20height%3F292.4%27%3E%3Cpath%20fill%3D%27%230B4C5F%27%20d%3D%27M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-13%205.4A17.6%2017.6%200%200%200%200%2087.2c0%205%201.8%209.3%205.4%2013l131.3%20131.3c3.6%203.6%207.9%205.4%2013%205.4s9.3-1.8%2013-5.4L287%20100.2c3.6-3.6%205.4-7.9%205.4-13%200-5-1.8-9.3-5.4-13z%27%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 12px top 50%; background-size: 12px auto; padding-right: 30px; }

      .btn-reset {
        background: linear-gradient(145deg, #90a4ae, #78909c); color: white; border: none; padding: 12px 24px;
        border-radius: 50px; cursor: pointer; font-weight: 600; height: auto; 
        box-shadow: 0 4px 10px rgba(120, 144, 156, 0.3); transition: all 0.3s;
      }
      .btn-reset:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(120, 144, 156, 0.5); background: linear-gradient(145deg, #a7b6be, #869aa5); }

      .mini-loading-container { display: flex; align-items: center; gap: 10px; height: 45px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
      .spinner-s { border: 3px solid rgba(11, 76, 95, 0.2); border-top: 3px solid var(--primary-orange); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
      #loading-text-s { font-size: 13px; color: var(--text-light); font-weight: 500; }

      #content { display: grid; gap: 25px; grid-template-columns: 1fr; }
      @media (min-width: 700px) { #content { grid-template-columns: repeat(2, 1fr); } }
      @media (min-width: 1100px) { #content { grid-template-columns: repeat(3, 1fr); } }
      @media (min-width: 1400px) { #content { grid-template-columns: repeat(4, 1fr); } }

      /* --- å¡ç‰‡ï¼šæ·ºè‰²ç»ç’ƒ --- */
      .card { 
        background: var(--glass-bg-light);
        backdrop-filter: var(--backdrop-blur);
        -webkit-backdrop-filter: var(--backdrop-blur);
        border: var(--glass-border-light);
        box-shadow: var(--glass-shadow);
        border-radius: 16px; 
        padding: 25px; 
        transition: all 0.3s ease;
        display: flex; flex-direction: column; justify-content: space-between;
        /* ç§»é™¤èˆŠçš„å·¦å´é‚Šæ¡†ï¼Œæ”¹ç”¨æ•´é«”ç™¼å…‰æ„Ÿ */
        position: relative; overflow: hidden;
      }
      /* å¡ç‰‡æ‡¸åœæ•ˆæœï¼šæ›´æµ®èµ·ã€é‚Šæ¡†æ›´äº® */
      .card:hover { 
        transform: translateY(-8px) scale(1.01); 
        box-shadow: 0 15px 40px rgba(31, 38, 135, 0.15);
        border-color: rgba(255, 255, 255, 0.8);
      }
      /* å¡ç‰‡é ‚éƒ¨è£é£¾æ¢ (å–ä»£èˆŠçš„å·¦å´é‚Šæ¡†) */
      .card::before {
          content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
          background: linear-gradient(90deg, var(--primary-teal), var(--sky-blue));
          opacity: 0.8;
      }
      
      .card h3 { margin: 15px 0 10px 0; font-size: 1.3em; font-weight: 700; color: var(--primary-teal); line-height: 1.4; }
      .tags { margin-bottom: 12px; }
      /* æ¨™ç±¤ï¼šä½¿ç”¨æ¸…æ–°è—ï¼Œç¨å¾®é€æ˜ */
      .tag { display: inline-block; background: rgba(174, 222, 244, 0.3); color: var(--primary-teal); font-size: 0.85em; padding: 4px 10px; border-radius: 8px; margin-right: 5px; margin-bottom: 6px; font-weight: 600; border: 1px solid rgba(174, 222, 244, 0.5); }
      .tag-type { background-color: rgba(255, 243, 224, 0.5); color: #e65100; border: 1px solid rgba(255, 183, 77, 0.5); }
      .meta { font-size: 0.9em; color: var(--text-light); margin-bottom: 20px; font-weight: 500; line-height: 1.8; }
      
      .tag-mini { font-size: 0.85em; padding: 3px 8px; border-radius: 6px; font-weight: 700; vertical-align: middle; display: inline-block; margin-top: 4px; }
      .tag-license-cc { background: rgba(0, 121, 107, 0.15); color: #00796b; }
      .tag-license-view { background: rgba(230, 81, 0, 0.15); color: #e65100; }
      .tag-license-cc0 { background: rgba(69, 90, 100, 0.15); color: #455a64; }

      .btn { 
        padding: 12px; 
        border-radius: 12px; 
        width: fit-content;   /* å¯¬åº¦éš¨å…§å®¹ç¸®æ”¾ */
        min-width: 180px;     /* ä¿æŒä»½é‡æ„Ÿ */
        margin: 10px auto 0;  /* æ°´å¹³ç½®ä¸­é—œéµ */} 

      #first-load-loading { text-align: center; padding: 60px; color: var(--text-light); }

      /* --- Footer: æ·±è‰²ç»ç’ƒ --- */
      footer { 
        background: var(--glass-bg-dark);
        backdrop-filter: var(--backdrop-blur);
        -webkit-backdrop-filter: var(--backdrop-blur);
        border-top: var(--glass-border-dark);
        color: #cfd8dc; 
        padding: 50px 20px; margin-top: 60px; text-align: center; font-size: 0.95em; 
      }
      .disclaimer-box { 
        max-width: 900px; margin: 0 auto 25px; 
        border: 1px solid rgba(255,255,255,0.15); 
        padding: 30px; border-radius: 16px; 
        background: rgba(0,0,0,0.2); /* æ¯” footer èƒŒæ™¯æ›´æ·±ä¸€é» */
        line-height: 1.8; box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
      }
      
      .license-explanation { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; margin: 25px 0; text-align: left; }
      .license-item { background: rgba(255, 255, 255, 0.07); padding: 20px; border-radius: 12px; border-left: 5px solid var(--sky-blue); transition: transform 0.3s; }
      .license-item:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.1); }
      .license-title { font-weight: 700; color: var(--sky-blue); margin-bottom: 8px; display: block; font-size: 1.05em; }
      .license-desc { font-size: 0.9em; color: #eceff1; line-height: 1.6; }

      .copyright { color: var(--sky-blue); font-weight: 700; font-size: 1.1em; display: block; margin-top: 15px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
      
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      @media (max-width: 600px) {
        .control-panel { flex-direction: column; align-items: stretch; padding: 20px; }
        .filter-group, #searchInput, .btn-reset { width: 100%; }
        header { padding: 30px 15px; }
        header h1 { font-size: 1.6em; }
        .notice-box { padding: 15px; }
        .card { padding: 20px; }
      }
    </style>
  </head>
  <body>
  <header>
      <h1>ğŸ“ç‰¹æ•™æ•™æè³‡æºå…±äº«å¹³å°</h1>
      <p>åŒ¯é›†å„è·¯ç‰¹æ•™è€å¸«çš„æ™ºæ…§ï¼Œè®“å‚™èª²æ›´è¼•é¬†</p>
      
      <div class="notice-box">
        <span class="notice-title">âš ï¸ å°Šé‡åŸå‰µè²æ˜</span>
        <p class="notice-content">
          æœ¬å¹³å°ä¹‹è³‡æºçš†ç‚ºç‰¹æ•™è€å¸«å€‘ç„¡ç§åˆ†äº«ã€‚è‹¥æ‚¨éœ€æ–¼å…¬é–‹å ´åˆåˆ†äº«æˆ–å¼•ç”¨ï¼Œ
          <strong>è«‹å‹™å¿…æ¨™è¨»ä¾†æº</strong>ä»¥å°Šé‡åŸå‰µè€…ï¼Œä¸¦è«‹ä¾ç…§åŸå‰µè€…æ‰€è¨­å®šçš„æˆæ¬Šè¦ç¯„ä½¿ç”¨ï¼Œå…±åŒç¶­è­·è‰¯å–„çš„åˆ†äº«å¾ªç’°ã€‚
        </p>
      </div>

      <a href="https://forms.gle/39VbaK5bLfzqMHz69" target="_blank" class="btn-share">ğŸ“¤ æˆ‘è¦åˆ†äº«æ•™æ</a>
    </header>

    <div class="container">
      <div class="control-panel">
        <div class="filter-group">
            <label>ğŸ” é—œéµå­—æœå°‹</label>
            <input type="text" id="searchInput" onkeyup="debounceFilter()" placeholder="æœå°‹æ•™æåç¨±...">
        </div>
        
        <div class="filter-group"><label>ğŸ“ å¹´ç´š</label><select id="gradeSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        <div class="filter-group"><label>ğŸ“– ç§‘ç›®</label><select id="subjectSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        <div class="filter-group"><label>ğŸ“‚ é¡å‹</label><select id="typeSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        <div class="filter-group"><label>ğŸ§  èªçŸ¥ç¨‹åº¦</label><select id="charSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        
        <button class="btn-reset" onclick="resetFilters()">æ¸…é™¤ç¯©é¸</button>

        <div id="mini-loading" class="mini-loading-container">
          <div class="spinner-s"></div>
          <span id="loading-text-s">åŒæ­¥ä¸­...</span>
        </div>
      </div>

      <div id="first-load-loading" style="display:none;">
          <div class="spinner-s" style="width:50px; height:50px; margin:0 auto 20px; border-width:4px;"></div>
          <div style="font-weight: 500; color: var(--primary-teal);">æ­£åœ¨é€£ç·šè‡³é›²ç«¯è¼‰å…¥æ•™æ...</div>
      </div>
      
      <div id="content"></div>
    </div>

    <footer>
      <div class="disclaimer-box">
        <p style="font-size: 1.2em; color: white; margin-bottom: 20px;"><strong>ğŸ“œ æ•™ææˆæ¬Šèªªæ˜</strong></p>
        <div class="license-explanation">
            <div class="license-item" style="border-color: #AEDEF4;">
                <span class="license-title">ğŸ¨ CC BY-NC-SA æˆæ¬Š</span>
                <span class="license-desc">å…è¨±éå•†æ¥­æ€§ä½¿ç”¨ã€ä¿®æ”¹ã€å†åˆ†äº«ï¼Œä½†é ˆè¨»æ˜ä½œè€…ï¼Œä¸”é ˆä»¥åŒæ¨£æˆæ¬Šåˆ†äº«ã€‚</span>
            </div>
            <div class="license-item" style="border-color: #E67432;">
                <span class="license-title">ğŸ‘ï¸ åƒ…ä¾›æŸ¥çœ‹èˆ‡åƒè€ƒ</span>
                <span class="license-desc">åƒ…å…è¨±æ•™å­¸ä½¿ç”¨ï¼Œä¸å…è¨±ä¿®æ”¹æˆ–äºŒæ¬¡å‰µä½œï¼Œç‰ˆæ¬Šæ­¸åŸä½œè€…æ‰€æœ‰ã€‚</span>
            </div>
            <div class="license-item" style="border-color: #90A4AE;">
                <span class="license-title">ğŸ”“ CC0 / å…¬æœ‰é ˜åŸŸ</span>
                <span class="license-desc">ä½œè€…æ”¾æ£„æ‰€æœ‰ç‰ˆæ¬Šï¼Œå…è¨±è‡ªç”±ä¿®æ”¹ã€ä½¿ç”¨ï¼Œç„¡éœ€æ¨™è¨»ä¾†æºã€‚</span>
            </div>
        </div>
        <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:30px 0;">

        <p style="font-size: 1.1em; color: white;"><strong>âš ï¸ å…è²¬è²æ˜ (Disclaimer)</strong></p>
        <p>æœ¬å¹³å°ä¹‹æ•™æå…§å®¹å‡ç”±å„ç‰¹æ•™è€å¸«åˆ†äº«ï¼Œæœ¬äººåƒ…è² è²¬å½™æ•´èˆ‡æ¶è¨­ã€‚æ•™æç‰ˆæ¬Šæ­¸åŸä½œè€…æ‰€æœ‰ï¼Œé€£çµæœ‰æ•ˆæ€§è«‹è‡ªè¡Œæ–Ÿé…Œã€‚</p>
      </div>
      <span class="copyright">Designed by ç±³å…‹å¸«</span>
    </footer>

    <script>
      // (JS éƒ¨åˆ†ä¿æŒå®Œå…¨ä¸è®Š)
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw_share.js')
            .then(reg => console.log('æ•™æå¹³å° PWA è¨»å†ŠæˆåŠŸ'))
            .catch(err => console.log('PWA è¨»å†Šå¤±æ•—', err));
        });
      }

      const API_URL = "https://script.google.com/macros/s/AKfycbx_j6IJv8JZcycXQ8U8HTHCbsP7s6VixUG7TsUfgHd8Y-5pyHf4COdfzTsnvDHPoS1M2A/exec";
      const CACHE_KEY = "sped_data_v1";
      const CACHE_TIME_KEY = "sped_timestamp";
      const CACHE_DURATION = 10 * 60 * 1000; 

      const COL_CREATOR_IDX = 1;
      const COL_NAME_IDX = 2;
      const COL_SUBJECT_IDX = 3;
      const COL_GRADE_IDX = 4;
      const COL_LINK_IDX = 5;
      const COL_TYPE_IDX = 10;
      const COL_LICENSE_IDX = 11; 
      const COL_CHAR_IDX = 13;

      const GRADE_ORDER = ["å­¸å‰", "å°ä¸€", "å°äºŒ", "å°ä¸‰", "å°å››", "å°äº”", "å°å…­", "åœ‹ä¸€", "åœ‹äºŒ", "åœ‹ä¸‰", "é«˜ä¸€", "é«˜äºŒ", "é«˜ä¸‰", "ä¸é™å®š"];
      const COGNITIVE_ORDER = ["èªçŸ¥åŠŸèƒ½ç„¡ç¼ºæ", "èªçŸ¥åŠŸèƒ½è¼•å¾®ç¼ºæ", "èªçŸ¥åŠŸèƒ½ä¸­åº¦ç¼ºæ", "èªçŸ¥åŠŸèƒ½åš´é‡ç¼ºæ", "ä¸åˆ†ç¨‹åº¦ / é€šç”¨å‹"];

      let allData = [];
      let searchTimer;

      window.onload = async function() {
        const cachedData = localStorage.getItem(CACHE_KEY);
        const cachedTime = localStorage.getItem(CACHE_TIME_KEY);
        const now = new Date().getTime();
        const miniLoading = document.getElementById('mini-loading');

        if (cachedData && cachedTime && (now - cachedTime < CACHE_DURATION)) {
            allData = JSON.parse(cachedData);
            processAndRender(allData, true); 
            miniLoading.style.opacity = "1";
        } else {
            document.getElementById('first-load-loading').style.display = 'block';
        }

        try {
          const response = await fetch(API_URL);
          const data = await response.json();
          data.shift(); 
          
          const freshData = data.map(row => ({
            creator: row[COL_CREATOR_IDX],
            name: row[COL_NAME_IDX],
            subject: row[COL_SUBJECT_IDX],
            grade: row[COL_GRADE_IDX],
            link: row[COL_LINK_IDX],
            type: row[COL_TYPE_IDX],
            license: row[COL_LICENSE_IDX],
            char: row[COL_CHAR_IDX]
          }));

          localStorage.setItem(CACHE_KEY, JSON.stringify(freshData));
          localStorage.setItem(CACHE_TIME_KEY, now.toString());

          allData = freshData;
          processAndRender(allData, false);
        } catch (e) {
          miniLoading.style.opacity = "0";
          document.getElementById('first-load-loading').style.display = 'none';
          console.error("Fetch error:", e);
        }
      };

      function processAndRender(data, isUpdating) {
        document.getElementById('first-load-loading').style.display = 'none';
        if (!isUpdating) { document.getElementById('mini-loading').style.opacity = "0"; }
        populateDropdown('gradeSelect', 'grade');
        populateDropdown('subjectSelect', 'subject');
        populateDropdown('typeSelect', 'type');
        populateDropdown('charSelect', 'char');
        renderCards(data);
      }

      function populateDropdown(elementId, key) {
        const select = document.getElementById(elementId);
        const currentValue = select.value;
        select.innerHTML = '<option value="All">å…¨éƒ¨</option>'; 
        let valuesSet = new Set();
        allData.forEach(item => {
          let rawValue = String(item[key] || "");
          if (rawValue.trim() !== "") {
            let parts = rawValue.split(/[,ï¼Œã€]/); 
            parts.forEach(p => valuesSet.add(p.trim()));
          }
        });

        let uniqueValues = Array.from(valuesSet);
        if (key === 'grade') {
          uniqueValues.sort((a, b) => { 
             let idxA = GRADE_ORDER.indexOf(a); 
             let idxB = GRADE_ORDER.indexOf(b); 
             return (idxA === -1 ? 999 : idxA) - (idxB === -1 ? 999 : idxB);
          });
        } else if (key === 'char') {
          uniqueValues.sort((a, b) => { 
             let idxA = COGNITIVE_ORDER.indexOf(a); 
             let idxB = COGNITIVE_ORDER.indexOf(b); 
             return (idxA === -1 ? 999 : idxA) - (idxB === -1 ? 999 : idxB);
          });
        } else { uniqueValues.sort(); }

        uniqueValues.forEach(val => {
          let opt = document.createElement("option");
          opt.value = val; opt.text = val; 
          select.appendChild(opt);
        });
        select.value = currentValue;
      }

      function debounceFilter() {
        clearTimeout(searchTimer);
        searchTimer = setTimeout(() => { filterData(); }, 300);
      }

      function filterData() {
        const keyword = document.getElementById('searchInput').value.toLowerCase().trim();
        const grade = document.getElementById('gradeSelect').value;
        const subject = document.getElementById('subjectSelect').value;
        const type = document.getElementById('typeSelect').value;
        const char = document.getElementById('charSelect').value;

        const filtered = allData.filter(item => {
          const matchKeyword = String(item.name || "").toLowerCase().includes(keyword);
          const matchGrade = (grade === 'All') || String(item.grade || "").includes(grade);
          const matchSubject = (subject === 'All') || String(item.subject || "").includes(subject);
          const matchType = (type === 'All') || String(item.type || "").includes(type);
          const matchChar = (char === 'All') || String(item.char || "").includes(char);
          return matchKeyword && matchGrade && matchSubject && matchType && matchChar;
        });
        renderCards(filtered);
      }

      function resetFilters() {
        document.getElementById('searchInput').value = "";
        document.getElementById('gradeSelect').value = "All";
        document.getElementById('subjectSelect').value = "All";
        document.getElementById('typeSelect').value = "All";
        document.getElementById('charSelect').value = "All";
        filterData(); 
       }

      function renderCards(data) {
        const container = document.getElementById('content');
        if(data.length === 0) { 
             container.innerHTML = "<div style='grid-column:1/-1; text-align:center; color: var(--primary-teal); padding: 40px; font-weight:500; background: var(--glass-bg-light); border-radius: 16px; backdrop-filter: var(--backdrop-blur);'>ğŸ” æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ•™æã€‚</div>"; 
             return; 
         }

        container.innerHTML = data.map(item => {
          let link = String(item.link || "").trim();
          let btnHtml = (link.startsWith("http")) 
             ? `<a href="${link}" target="_blank" class="btn">å‰å¾€æ•™æ</a>` 
             : `<div class="btn disabled">ç„¡é€£çµ</div>`;

          let licRaw = String(item.license || "");
          let licShort = "æœªçŸ¥æˆæ¬Š";
          let licClass = "tag-license-other";

          if(licRaw.includes("CC BY-NC-SA")) { licShort = "CC BY-NC-SA"; licClass = "tag-license-cc"; } 
          else if(licRaw.includes("åƒ…ä¾›æŸ¥çœ‹")) { licShort = "åƒ…ä¾›æŸ¥çœ‹"; licClass = "tag-license-view"; } 
          else if(licRaw.includes("CC0")) { licShort = "CC0 å…¬æœ‰é ˜åŸŸ"; licClass = "tag-license-cc0"; }

          return `
            <div class="card">
              <div>
                <div class="tags">
                  <span class="tag">${item.subject || "æœªåˆ†é¡"}</span>
                  <span class="tag">${item.grade || "æœªåˆ†é¡"}</span>
                  ${item.type ? `<span class="tag tag-type">${item.type}</span>` : ''}
                </div>
                <h3>${item.name || "æœªå‘½åæ•™æ"}</h3>
                <div class="meta">
                    ğŸ‘¤ åˆ†äº«è€…ï¼š${item.creator || "åŒ¿å"}<br>
                    ğŸ“Š ç¨‹åº¦ï¼š${item.char || "ä¸é™"}<br>
                    âš–ï¸ æˆæ¬Šï¼š<span class="tag-mini ${licClass}" title="${licRaw}">${licShort}</span>
                </div>
              </div>
              ${btnHtml}
            </div>`;
        }).join('');
      }
    </script>
  </body>
</html>
