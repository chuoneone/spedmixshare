<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ç‰¹æ•™æ•™æè³‡æºå…±äº«å¹³å°</title>
    
    <link rel="icon" href="sped2.png" type="image/png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --primary-color: #4DB6AC;
        --primary-dark: #00897B;
        --bg-color: #f0f4f7;
        --card-bg: #ffffff;
        --text-color: #37474f;
        --text-light: #78909c;
        --tag-bg: #e0f2f1;
        --tag-text: #00796b;
      }
      body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; }
      
      header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 40px 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
      header h1 { margin: 0; font-size: 2em; font-weight: 700; letter-spacing: 1px; }
      header p { margin-top: 10px; opacity: 0.9; margin-bottom: 20px; }

      /* ğŸŸ¢ æ–°å¢ï¼šåˆ†äº«æŒ‰éˆ•æ¨£å¼ */
      .btn-share {
        display: inline-block;
        background-color: #ffffff;
        color: var(--primary-dark);
        padding: 10px 24px;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 700;
        box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        transition: all 0.3s ease;
        margin-top: 10px;
      }
      .btn-share:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        background-color: #f1f8e9;
      }

      .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; flex: 1; box-sizing: border-box; width: 100%; }
      
      /* æ§åˆ¶é¢æ¿æ¨£å¼ */
      .control-panel { 
        background: white; padding: 25px; border-radius: 12px; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; 
        display: flex; flex-wrap: wrap; gap: 15px; 
        align-items: flex-end; 
        justify-content: center; 
      }
      
      .filter-group { display: flex; flex-direction: column; gap: 5px; }
      .filter-group label { font-size: 0.9em; font-weight: bold; color: var(--primary-dark); }
      
      #searchInput {
        padding: 10px 15px; border-radius: 8px; border: 1px solid #cfd8dc;
        font-size: 14px; width: 200px; transition: border 0.3s;
      }
      #searchInput:focus { border-color: var(--primary-color); outline: none; }

      select { padding: 10px 15px; border-radius: 8px; border: 1px solid #cfd8dc; font-size: 14px; background-color: #fff; min-width: 130px; cursor: pointer; }
      
      .btn-reset {
        background-color: #90a4ae; color: white; border: none; padding: 10px 20px;
        border-radius: 8px; cursor: pointer; font-weight: 500; height: 40px; 
      }
      .btn-reset:hover { background-color: #78909c; }

      /* å…§å®¹å€åŸŸ Grid è¨­å®š */
      #content { display: grid; gap: 20px; grid-template-columns: 1fr; }
      @media (min-width: 600px) { #content { grid-template-columns: repeat(2, 1fr); } }
      @media (min-width: 1024px) { #content { grid-template-columns: repeat(4, 1fr); } } /* å››æ¬„ */

      .card { 
        background: var(--card-bg); border-radius: 12px; padding: 20px; 
        box-shadow: 0 3px 6px rgba(0,0,0,0.05); border-left: 6px solid var(--primary-color); 
        transition: transform 0.2s, box-shadow 0.2s; 
        display: flex; flex-direction: column; justify-content: space-between; 
      }
      .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
      
      .card h3 { 
        margin: 0 0 10px 0; 
        font-size: 1.25em; 
        font-weight: 700; 
        color: #263238;
      }
      
      .tags { margin-bottom: 10px; }
      .tag { display: inline-block; background: var(--tag-bg); color: var(--tag-text); font-size: 0.8em; padding: 3px 8px; border-radius: 6px; margin-right: 4px; margin-bottom: 6px; font-weight: 500; }
      .tag-type { background-color: #fff3e0; color: #e65100; }
      
      .meta { font-size: 0.85em; color: var(--text-light); margin-bottom: 15px; font-weight: 500; line-height: 1.6; }
      
      .btn { display: block; background-color: var(--primary-color); color: white; text-align: center; padding: 10px; text-decoration: none; border-radius: 8px; font-weight: 500; transition: background 0.3s; }
      .btn:hover { background-color: var(--primary-dark); }
      .btn.disabled { background-color: #cfd8dc; color: #90a4ae; cursor: not-allowed; pointer-events: none; }

      /* Spinner */
      #loading { text-align: center; padding: 50px; color: var(--text-light); }
      .spinner {
        border: 4px solid #e0f2f1; border-top: 4px solid var(--primary-color);
        border-radius: 50%; width: 40px; height: 40px;
        animation: spin 1s linear infinite; margin: 0 auto 15px auto;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      footer { background-color: #263238; color: #b0bec5; padding: 40px 20px; margin-top: 50px; text-align: center; font-size: 0.9em; }
      .disclaimer-box { max-width: 850px; margin: 0 auto 20px; border: 1px solid #37474f; padding: 20px; border-radius: 12px; background: rgba(255,255,255,0.05); line-height: 1.7; }
      .copyright { color: #80cbc4; font-weight: bold; font-size: 1.1em; display: block; margin-top: 10px; }
      
      @media (max-width: 600px) {
        .control-panel { flex-direction: column; align-items: stretch; }
        .filter-group, #searchInput, .btn-reset { width: 100%; }
        header h1 { font-size: 1.5em; }
      }
    </style>
  </head>
  <body>

    <header>
      <h1>ğŸ“ç‰¹æ•™æ•™æè³‡æºå…±äº«å¹³å°</h1>
      <p>åŒ¯é›†å„è·¯ç‰¹æ•™è€å¸«çš„æ™ºæ…§ï¼Œè®“å‚™èª²æ›´è¼•é¬†</p>
      <a href="https://forms.gle/39VbaK5bLfzqMHz69" target="_blank" class="btn-share">ğŸ“¤ æˆ‘è¦åˆ†äº«æ•™æ</a>
    </header>

    <div class="container">
      <div class="control-panel">
        <div class="filter-group">
            <label>ğŸ” é—œéµå­—æœå°‹</label>
            <input type="text" id="searchInput" oninput="filterData()" placeholder="æœå°‹æ•™æåç¨±...">
        </div>
        
        <div class="filter-group"><label>ğŸ“ å¹´ç´š</label><select id="gradeSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        <div class="filter-group"><label>ğŸ“– ç§‘ç›®</label><select id="subjectSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        <div class="filter-group"><label>ğŸ“‚ é¡å‹</label><select id="typeSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        <div class="filter-group"><label>ğŸ‘¤ å­¸ç”Ÿç‰¹æ€§</label><select id="charSelect" onchange="filterData()"><option value="All">å…¨éƒ¨</option></select></div>
        
        <button class="btn-reset" onclick="resetFilters()">æ¸…é™¤ç¯©é¸</button>
      </div>

      <div id="loading">
        <div class="spinner"></div>
        <div>ğŸš€ æ­£åœ¨é€£ç·šè‡³ Google é›²ç«¯è¼‰å…¥æ•™æ...</div>
      </div>
      
      <div id="content"></div>
    </div>

    <footer>
      <div class="disclaimer-box">
        <p><strong>âš ï¸ å…è²¬è²æ˜ (Disclaimer)</strong></p>
        <p>æœ¬å¹³å°ä¹‹æ•™æå…§å®¹å‡ç”±å„ç‰¹æ•™è€å¸«åˆ†äº«ï¼Œæœ¬äººåƒ…è² è²¬å½™æ•´èˆ‡æ¶è¨­ã€‚æ•™æç‰ˆæ¬Šæ­¸åŸä½œè€…æ‰€æœ‰ï¼Œé€£çµæœ‰æ•ˆæ€§è«‹è‡ªè¡Œæ–Ÿé…Œã€‚</p>
      </div>
      <span class="copyright">Designed by ç±³å…‹å¸«</span>
    </footer>

    <script>
      const API_URL = "https://script.google.com/macros/s/AKfycbx_j6IJv8JZcycXQ8U8HTHCbsP7s6VixUG7TsUfgHd8Y-5pyHf4COdfzTsnvDHPoS1M2A/exec";

      const COL_CREATOR_IDX = 1;
      const COL_NAME_IDX = 2;
      const COL_SUBJECT_IDX = 3;
      const COL_GRADE_IDX = 4;
      const COL_LINK_IDX = 5;
      const COL_TYPE_IDX = 10;
      const COL_CHAR_IDX = 13;

      const GRADE_ORDER = ["å­¸å‰", "å°ä¸€", "å°äºŒ", "å°ä¸‰", "å°å››", "å°äº”", "å°å…­", "åœ‹ä¸€", "åœ‹äºŒ", "åœ‹ä¸‰", "é«˜ä¸€", "é«˜äºŒ", "é«˜ä¸‰", "ä¸é™å®š"];
      
      let allData = [];

      window.onload = async function() {
        try {
          const response = await fetch(API_URL);
          const data = await response.json();
          processData(data);
        } catch (e) {
          document.getElementById('loading').innerHTML = "âŒ è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèª API ç¶²å€æ˜¯å¦æ­£ç¢ºä¸¦å·²ç™¼å¸ƒç‚ºã€Œä»»ä½•äººã€ã€‚<br>" + e;
          console.error(e);
        }
      };

      function processData(data) {
        document.getElementById('loading').style.display = 'none';
        data.shift(); 

        allData = data.map(row => ({
            creator: row[COL_CREATOR_IDX],
            name: row[COL_NAME_IDX],
            subject: row[COL_SUBJECT_IDX],
            grade: row[COL_GRADE_IDX],
            link: row[COL_LINK_IDX],
            type: row[COL_TYPE_IDX],
            char: row[COL_CHAR_IDX]
        }));

        populateDropdown('gradeSelect', 'grade');
        populateDropdown('subjectSelect', 'subject');
        populateDropdown('typeSelect', 'type');
        populateDropdown('charSelect', 'char');

        renderCards(allData);
      }

      function populateDropdown(elementId, key) {
        const select = document.getElementById(elementId);
        let valuesSet = new Set();
        
        allData.forEach(item => {
          let rawValue = String(item[key] || "");
          if (rawValue.trim() !== "") {
            let parts = rawValue.split(/[,ï¼Œã€]/); 
            parts.forEach(p => valuesSet.add(p.trim()));
          }
        });

        let uniqueValues = Array.from(valuesSet);
        
        if (key === 'grade') {
          uniqueValues.sort((a, b) => {
             let idxA = GRADE_ORDER.indexOf(a);
             let idxB = GRADE_ORDER.indexOf(b);
             return (idxA === -1 ? 999 : idxA) - (idxB === -1 ? 999 : idxB);
          });
        } else {
          uniqueValues.sort();
        }

        uniqueValues.forEach(val => {
          let opt = document.createElement("option");
          opt.value = val; opt.text = val; 
          select.appendChild(opt);
        });
      }

      function filterData() {
        const keyword = document.getElementById('searchInput').value.toLowerCase().trim();
        const grade = document.getElementById('gradeSelect').value;
        const subject = document.getElementById('subjectSelect').value;
        const type = document.getElementById('typeSelect').value;
        const char = document.getElementById('charSelect').value;

        const filtered = allData.filter(item => {
          const nameStr = String(item.name || "").toLowerCase();
          const gradeStr = String(item.grade || "");
          const subjectStr = String(item.subject || "");
          const typeStr = String(item.type || "");
          const charStr = String(item.char || "");

          const matchKeyword = nameStr.includes(keyword);
          const matchGrade = (grade === 'All') || gradeStr.includes(grade);
          const matchSubject = (subject === 'All') || subjectStr.includes(subject);
          const matchType = (type === 'All') || typeStr.includes(type);
          const matchChar = (char === 'All') || charStr.includes(char);

          return matchKeyword && matchGrade && matchSubject && matchType && matchChar;
        });

        renderCards(filtered);
      }

      function resetFilters() {
        document.getElementById('searchInput').value = "";
        document.getElementById('gradeSelect').value = "All";
        document.getElementById('subjectSelect').value = "All";
        document.getElementById('typeSelect').value = "All";
        document.getElementById('charSelect').value = "All";
        filterData(); 
      }

      function renderCards(data) {
        const container = document.getElementById('content');
        
        if(data.length === 0) { 
            container.innerHTML = "<div style='grid-column:1/-1; text-align:center; color:#888; padding: 40px;'>ğŸ” æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ•™æï¼Œè«‹å˜—è©¦èª¿æ•´ç¯©é¸æ¢ä»¶ã€‚</div>"; 
            return; 
        }

        const htmlString = data.map(item => {
          let link = String(item.link || "").trim();
          let btnHtml = (link.startsWith("http")) 
            ? `<a href="${link}" target="_blank" class="btn">å‰å¾€æ•™æ</a>` 
            : `<div class="btn disabled">ç„¡é€£çµ</div>`;

          return `
            <div class="card">
              <div>
                <div class="tags">
                  <span class="tag">${item.subject || "æœªåˆ†é¡"}</span>
                  <span class="tag">${item.grade || "æœªåˆ†é¡"}</span>
                  ${item.type ? `<span class="tag tag-type">${item.type}</span>` : ''}
                </div>
                <h3>${item.name || "æœªå‘½åæ•™æ"}</h3>
                <div class="meta">
                    ğŸ‘¤ åˆ†äº«è€…ï¼š${item.creator || "åŒ¿å"}<br>
                    ğŸ§© é©ç”¨ï¼š${item.char || "ä¸é™"}
                </div>
              </div>
              ${btnHtml}
            </div>`;
        }).join('');

        container.innerHTML = htmlString;
      }
    </script>
  </body>
</html>